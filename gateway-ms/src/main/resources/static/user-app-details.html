<!DOCTYPE html>
<html>
<head>
    <title>App Details</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .stars span {
            font-size: 35px;
            cursor: pointer;
            color: #ddd;
            transition: 0.3s;
        }
        .stars span.active {
            color: gold;
            transform: scale(1.2);
        }
        .review-box {
            margin-top: 15px;
            padding: 15px;
            width: 90%;
            border-radius: 12px;
            background: rgba(255,255,255,0.25);
            outline: none;
            border: none;
            font-size: 16px;
        }
        .review-item {
            padding: 10px;
            margin-top: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            color: white;
            text-align: left;
        }
    </style>
</head>
<body>

<h1 id="appTitle">App Details</h1>

<div class="glass-card">

    <h2>Rate this App</h2>

    <div class="stars" id="stars">
        <span data-value="1">★</span>
        <span data-value="2">★</span>
        <span data-value="3">★</span>
        <span data-value="4">★</span>
        <span data-value="5">★</span>
    </div>

    <textarea id="reviewText" class="review-box" placeholder="Write your review..."></textarea>

    <button class="glass-btn" onclick="submitReview()">Submit Review</button>

    <h2 style="margin-top:25px;">User Reviews</h2>
    <div id="reviewList"></div>

</div>

<script>
let selectedStars = 0;
const appId = new URLSearchParams(window.location.search).get("id");

// ⭐ Activate stars
document.querySelectorAll(".stars span").forEach(star => {
    star.addEventListener("click", function() {
        selectedStars = this.getAttribute("data-value");
        highlightStars(selectedStars);
    });
});

function highlightStars(count) {
    document.querySelectorAll(".stars span").forEach(star => {
        star.classList.remove("active");
        if (star.getAttribute("data-value") <= count) {
            star.classList.add("active");
        }
    });
}

// ⭐ Submit rating & review
async function submitReview() {
    const review = document.getElementById("reviewText").value;

    if (selectedStars === 0) {
        alert("Choose a star rating first!");
        return;
    }

    const body = {
        appId: Number(appId),
        rating: Number(selectedStars),
        review: review
    };

    const res = await fetch(`http://localhost:8081/ratings/${appId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
    });

    if (!res.ok) {
        alert("Failed to add review!");
        return;
    }

    alert("Review submitted!");
    loadReviews();
}

// ⭐ Load all reviews
async function loadReviews() {
    const res = await fetch(`http://localhost:8081/ratings/${appId}`);
    const list = await res.json();

    const container = document.getElementById("reviewList");
    container.innerHTML = "";

    list.forEach(r => {
        container.innerHTML += `
            <div class="review-item">
                <strong>${"★".repeat(r.rating)}</strong><br>
                <p>${r.review}</p>
            </div>
        `;
    });
}

loadReviews();
</script>

</body>
</html>
